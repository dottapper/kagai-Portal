<!DOCTYPE html>
<!-- テーマ適用の先行スクリプト - FOUC/白画面解消 -->
<script>try{var d=document.documentElement;var s=(new URLSearchParams(location.search).get("theme"))||localStorage.getItem("theme")||"light";if(s==="light"||s==="dark"){d.setAttribute("data-theme",s);localStorage.setItem("theme",s);}d.classList.add("theme-loaded");}catch(e){document.documentElement.classList.add("theme-loaded");}</script>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>{% if title %}{{ title }} | {% endif %}全国花街ポータル</title>
  <meta name="description" content="{{ description | default('全国の花街文化を一箇所で。美しく静謐な情報体験を。') }}" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- Critical CSS to prevent FOUC -->
  <style>
    /* Prevent flash of unstyled content */
    html { visibility: hidden; }
    html.theme-loaded { visibility: visible; }
    
    /* Default light theme colors */
    :root {
      --bg-app: #f7f7f8;
      --bg-surface: #ffffff;
      --bg-floating: rgba(255,255,255,.74);
      --line: rgba(17,17,17,.08);
      --line-strong: rgba(17,17,17,.14);
      --text: #141516;
      --text-dim: rgba(20,21,22,.78);
      --text-mute: rgba(20,21,22,.58);
      --accent: #d4b072;
      --accent-2: #c03838;
      --serif: 'Yu Mincho','游明朝','Hiragino Mincho ProN','Hiragino Mincho Pro','Hiragino Mincho','Noto Serif JP',serif;
      --sans: 'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    }
    
    /* Dark theme colors */
    [data-theme="dark"] {
      --bg-app: #0e0e0f;
      --bg-surface: #151516;
      --bg-floating: rgba(21,21,22,.7);
      --line: rgba(255,255,255,.08);
      --line-strong: rgba(255,255,255,.14);
      --text: #fafafa;
      --text-dim: rgba(250,250,250,.75);
      --text-mute: rgba(250,250,250,.55);
    }
    
    body {
      margin: 0;
      font-family: var(--serif);
      background: var(--bg-app);
      color: var(--text);
      line-height: 1.8;
      -webkit-font-smoothing: antialiased;
      font-feature-settings: 'palt' 1, 'pkna' 1;
    }
  </style>

  <!-- Styles -->
  <link rel="stylesheet" href="{{ site.paths.css }}styles.css" />
  {% if css %}
    {% for stylesheet in css %}
      <link rel="stylesheet" href="{{ site.paths.css }}{{ stylesheet }}" />
    {% endfor %}
  {% endif %}

  <!-- Preload critical hero image for LCP -->
  {% if preloadImage %}<link rel="preload" as="image" href="{{ preloadImage }}" fetchpriority="high">{% endif %}

  <!-- Canonical URL -->
  <link rel="canonical" href="https://hanamachi-portal.com{{ page.url }}" />
  
  <!-- OG -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="{% if title %}{{ title }} | {% endif %}全国花街ポータル" />
  <meta property="og:description" content="{{ description | default('全国の花街文化を一箇所で。美しく静謐な情報体験を。') }}" />
  <meta property="og:image" content="https://hanamachi-portal.com/images/top/top1.jpg" />
  <meta property="og:url" content="https://hanamachi-portal.com{{ page.url }}" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{% if title %}{{ title }} | {% endif %}全国花街ポータル" />
  <meta name="twitter:description" content="{{ description | default('全国の花街文化を一箇所で。美しく静謐な情報体験を。') }}" />
  <meta name="twitter:image" content="https://hanamachi-portal.com/images/top/top1.jpg" />
  
  <link rel="icon" href="{{ site.paths.assets }}logo.png" type="image/png" />

  {% if structuredData %}
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {{ structuredData | safe }}
  </script>
  {% endif %}
</head>
<body>
  
  {% include "header.njk" %}
  
  <main id="main-content" class="main-content">
    {{ content | safe }}
  </main>
  
  {% include "footer.njk" %}

  <!-- Scripts -->
  <script src="{{ site.paths.js }}script.js"></script>
  {% if js %}
    {% for script in js %}
      <script src="{{ site.paths.js }}{{ script }}"></script>
    {% endfor %}
  {% endif %}
  {% if templateLoader %}<script src="{{ site.paths.js }}template-loader.js"></script>{% endif %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
